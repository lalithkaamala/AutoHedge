name: Time-Release Vault

on:
  schedule:
    # Run at 12:00 PM UTC every 3 days
    - cron: '0 12 */3 * *'
  workflow_dispatch: # Manual trigger

permissions:
  contents: write

jobs:
  release-project:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Code
      uses: actions/checkout@v4

    - name: Release Next Project
      run: |
        # Define the order of release
        PROJECTS=("mean_reversion" "fourier_transform" "fractal_analysis" "heston_model" "efficient_frontier" "pairs_trading" "volatility_surface")
        
        for PROJECT in "${PROJECTS[@]}"; do
          VAULT_PATH="Quant-Projects/.vault/$PROJECT"
          PUBLIC_PATH="Quant-Projects/$PROJECT"
          
          # Check if project exists in vault but not in public
          if [ -d "$VAULT_PATH" ] && [ ! -d "$PUBLIC_PATH" ]; then
            echo "ðŸš€ Releasing $PROJECT from the Vault..."
            
            # Move manually (copy then delete from vault to keep git history clean if we wanted, 
            # but here we just copy to simulate "new work" appearing)
            cp -r "$VAULT_PATH" "$PUBLIC_PATH"
            
            # Configure Git
            git config --global user.name "AutoHedge Bot"
            git config --global user.email "bot@autohedge.ai"
            
            # Commit and Push
            git add "$PUBLIC_PATH"
            git commit -m "âœ¨ New Quant Release: $PROJECT (Polymath Edition)"
            git push
            
            echo "âœ… Released $PROJECT"
            
            # --- NEURAL LINK: Broadcast to External Automation (Zapier/Make/Discord) ---
            if [ ! -z "${{ secrets.WEBHOOK_URL }}" ]; then
              echo "ðŸ“¡ Broadcasting update to Neural Link..."
              curl -X POST -H "Content-Type: application/json" \
                   -d "{\"project\": \"$PROJECT\", \"status\": \"released\", \"message\": \"New Quant Project Released: $PROJECT\"}" \
                   ${{ secrets.WEBHOOK_URL }}
            fi
            
            exit 0 # Exit after releasing ONE project
          fi
        done
        
        echo "No new projects to release (or all already released)."
